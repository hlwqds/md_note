# 标准I/O库

## 1 引言

标准库处理了很多细节，如缓冲区分配、以优化的块长度执行I/O等。这使得它便于用户使用，但是如果我们不深入了解I/O库函数的操作，也会带来一些问题。

## 2 流和FILE对象

在I/O库中，所有函数都是围绕文件描述符的。当打开一个文件时，即返回一个文件描述符，然后将文件描述符用于后续的I/O操作。而对于标准I/O库，他们的操作是围绕流进行的。当我们用标准I/O库打开或创建一个文件时，我们已使一个文件和流相关联。

对于ASCII字符集，一个字符用一个字节表示。对于国际字符集，一个字符可用于多个字节表示。标准I/O文件流可用于单字节或多字节字符集。流的定向决定了所读、写的字符是单字节还是多字节的。当一个流最初被创建时，它没有定向。如果在未定向的流上使用一个多字节I/O函数(见<wchar.h>)，则将该流的定向设置为宽定向的。如果在未定向的流上使用一个单字节I/O函数，则将流的定向设为字节定向的。只有两个函数可以改变流的定向。freopen函数清除一个流的定向；fwide函数可用于设置流的定向。

```c
#include <stdio.h>
#include <wchar.h>
extern int fwide (__FILE *__fp, int __mode) __THROW;
```

根据mode参数的不同值，fwide函数执行不同的工作。

- 如果mode参数值为负，fwide将试图使指定的流是字节定向的。
- 如果mode参数值为正，fwide将试图使指定的流是宽定向的。
- 如果mode的参数值为0，fwide将不试图设置流的定向，但返回标识该流定向的值。

注意，fwide并不改变已定向流的定向。而且fwide无出错返回，所以我们唯一可靠的是，在调用fwide前先清除errno，返回时检查errno的值。

当打开一个流时，标准I/O函数fopen返回一个指向FILE对象的指针。该对象通常是一个结构，它包含了标准I/O库为管理该流需要的所有信息。

## 3 标准输入、输出和错误流

对一个进程预定义了3个流。他们是标准输入、输出和错误流，他们使用的是对应的标准文件描述符。

## 专有名词

流  		stream

流定向		stream's orientation